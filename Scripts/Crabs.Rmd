# Chance's Second Thesis Chapter: Understand Thermal Niche from Consumption TPCs

Made by Chance Yan
Last Edit:

**Question:** Is there thermal niche overlap or complementarity in consumption among the predatory crabs of the Gulf of Maine?

**Hypothesis:** There is thermal niche complementarity between the crab predators. 

**Null Hypothesis:** There is thermal niche overlap between the crab predators.

**Predictions:**

-   Prediction 1: The asian shore crab will have the highest consumption TPC/thermal niche compared to green crabs and cancer crabs. Followed by green crabs having the second highest TPC/thermal niche. Meanwhile, cancer crabs (Cancer borealis preferred, but Cancer irroratus backup - more on this later)

-   Prediction 2:There is no difference in consumption TPC between green crabs, asian shore crabs, and cancer crabs. 

-   Prediction 3: There is some overlap between 2 of the species, but not the last one. 

**Experimental Design:**

2 Systems (2 possible temperatures at a time), 5 temperature regimes (minimum to map out a TPC), 3 species, 6 repetitions. We can only fit 18 individuals in each system.

6 reps \* 3 species \* 5 temperature regimes \* 2 temporal blocks = 180 crabs\

## Data Processing

```{R, include = FALSE, warning = FALSE}
library(ggplot2)
setwd("/Users/chanceyan/Documents/R/ThesisCrab/Data")
crabdata <- read.csv("Feeding.csv", h=T)
death <- read.csv("DeathCount.csv", h=T)
master <- read.csv("Master.csv", h=T)
```

#### Cleaning up data for use

We need to clean up the data first to use it. What I did...

-   Created a new value for each crab feeding point (Food in - Food out to get total eaten). Then calculated proportion eaten by taking the amount eaten and diving it by the body weight of the crab.

-   I pushed all those who did not eat to 0 (noted who didn't eat via bite marks, but didn't explicitly write 0 still).

-   Removed feeding points where individuals ate everything and those who died.

-   Removed those who molted during the experiment

-   Removed the mackerel and mussel feeding (since they were a one off feeding and did not measure well)

```{R include = FALSE, warning = FALSE}
crabdata$FoodIn <- as.numeric(as.character(crabdata$FoodIn))
crabdata$FoodOut <- as.numeric(as.character(crabdata$FoodOut))

for(i in 1:nrow(crabdata)){
  if(!is.numeric(crabdata[i,4])){
    crabdata <- crabdata[-i,]
  }
  if(!is.numeric(crabdata[i,6])){
    crabdata <- crabdata[-i,]
  }
}

#Creating number IDs for each crab based of their IDs so it's easier to loop through with future code. Also I'm adding a total eaten by proportion column, so we have a fair metric to compare by.

for(i in 1:36){
  master$num[[i]] <- substr(master$ID[[i]], 3,5)
}

crabdata$amount.eaten <- crabdata$FoodIn-crabdata$FoodOut
all <- merge(crabdata, master, by="ID")
all$proportion.eaten <- (all$amount.eaten / all$WW)
#Changing date column into a date data type, so that R can read it as a Date.
all$Date.x = as.Date(all$Date.x, format = "%m/%d/%Y")

#Making all those who did not eat to 0
for(i in 1:nrow(all)){
  if(grepl("DE", all$Notes.x[i], fixed = TRUE)){
    all$proportion.eaten[i] = 0
  }
  if(grepl("AE", all$Notes.x[i], fixed = TRUE)){
    all <- all[-i, ] 
  }
  if(grepl("DI", all$Notes.x[i], fixed = TRUE)){
    all <- all[-i, ] 
  }
  if(is.na(all$amount.eaten[i])){
    all <- all[-i,]
  }
  else{
    if(all$amount.eaten[i] < 0){
      all$proportion.eaten[i] = 0
    }
  }
}

#Removing those that molted
array <- c()

for(i in 1:nrow(all)){
  if(grepl("ME", all$Notes.x[i], fixed = TRUE)){
    ID_value <- all$ID[i]
    for(j in 1:nrow(all)){
      if(all$ID[j] == ID_value){
        array <- c(array, j)
      }
    }
  }
}

all <- all[-array,]
array <- c()

#removing mussel and mackerel feed
all <- subset(all, all$Food != "Mussels")
all <- subset(all, all$Food != "Mackerel")

#Removing these dates because feeding was not following a strict schedule (fed two days back to back)
all <- subset(all, (all$WeekNum != "1" | all$Trial.x != "16"))

#Changing trials 16 and 18 to be one.
all$Trial.x <- ifelse(all$Trial.x == "16", "18", all$Trial.x)
```

## Data Exploration

### Basic information on the dataset

```{r echo = FALSE, warning = FALSE}
c <- tapply(all$proportion.eaten, list(all$Species.x, all$Trial.x), FUN = length)

a <- tapply(all$CL, list(all$Species.x, all$Trial.x), FUN = mean)

library(knitr)
kable(c, caption = "Sample size for each species, trial")
kable(a, caption = "Average Carapace Length for each species, trial")
```

#### Species Comparison between carapace length and proportion eaten.

```{r, fig.show="hold", out.width="50%", echo = FALSE, warning = FALSE}
ggplot(all, aes(y = CL, color = Species.x)) + geom_boxplot() +
  scale_color_manual(values = c("CI" = "darkorange",
                                "CM"="darkgreen",
                                "HS"="darkred"))

ggplot(all, aes(y = proportion.eaten, color = Species.x)) + geom_boxplot() +
  scale_color_manual(values = c("CI" = "darkorange",
                                "CM"="darkgreen",
                                "HS"="darkred"))
```

Clear distinction between species:

-   *Cancer irroratus* are larger than the other two species followed by *Carcinus meanus* then the smallest as *Hemigrapsus*.

-   The pattern is opposite when it comes to the amount they've eaten proportionally. So *Hemigrapsus* eats the most and *Cancer irroratus* eats the least.

#### Carapace Length and Wet Weight Comparison between species

```{R, echo = FALSE, warning = FALSE}
ggplot(all, aes(x = WW, y = CL, color = Species.x)) + geom_point()+
  scale_color_manual(values = c("CI" = "darkorange",
                                "CM"="darkgreen",
                                "HS"="darkred"))
#There is an outlier who is CM 176 - I am willing to throw this individual out since he is the only one of it's kind
all <- subset(all, all$ID != "CM176")
```

There is a nice relationship between carapace length and wet weight. However, there was an outlier. I have thrown it out since it's the ONLY one so far off, but I have checked and data was entered correctly.

#### Death Count Among Species and Trial

```{R, echo = FALSE, warning = FALSE}
#Making a graph for counts
death$Species <- factor(death$Species, levels = c("HS", "CM", "CI"))
ggplot(death, aes(x = as.factor(Trial), y = Count, fill = Life)) + facet_wrap(~Species) + geom_bar(stat='identity')+
  scale_fill_manual(values = c("ALIVE" = "darkolivegreen4",
                                "DEAD"="darkred"))

```

*Cancer irroratus* have the highest death count among all 3 species with *Hemigrapsus* having none and *Carcinus meanus* only having two death counts. Across trials with *Cancer irroratus*, the higher the trial temperature the more deaths there are as well.

#### Food Type Effects on Proportion Eaten

```{R, echo = FALSE, warning = FALSE}
ggplot(all, aes(x = all$Food, y = proportion.eaten, fill = Species.x)) + geom_boxplot()+
  scale_fill_manual(values = c("CI" = "darkorange",
                                "CM"="darkgreen",
                                "HS"="darkred"))
```

Maybe looks like Hemigrapsus prefers squid a little more than clam? Although it's close enough to leave it be. Perhaps we should run statistical tests on it.

#### Statistical Test to see if Squid is preferred over Clam for all 3 species

```{R, warning = FALSE}
holddf <- subset(all, all$Species.x == "HS")
mod <- glm(holddf$proportion.eaten ~ holddf$Food)
summary(mod)

holddf <- subset(all, all$Species.x == "CM")
mod <- glm(holddf$proportion.eaten ~ holddf$Food)
summary(mod)

holddf <- subset(all, all$Species.x == "CI")
mod <- glm(holddf$proportion.eaten ~ holddf$Food)
summary(mod)
```

After running a t-test on these, it seems like green crabs and Hemigrapsus have a slight preference for squid rather than clam. Meanwhile Cancer crabs have no preference between the food types.

#### Checking for Outliers and that wet weight is normal

```{r, figures-side, fig.show="hold", out.width="50%", echo = FALSE, warning = FALSE}
#Pretty normal - looking good

holddf <- subset(all, all$Species.x == "CI")
ggplot(holddf, aes(x = WW)) + geom_histogram(binwidth = 25, fill = "darkorange", color = "black") + facet_wrap(~Species.x, scales = "free") + ggtitle("Wet weight for Cancer")

holddf <- subset(all, all$Species.x == "CM")
ggplot(holddf, aes(x = WW)) + geom_histogram(binwidth = 15, fill = "darkgreen", color = "black") + facet_wrap(~Species.x, scales = "free") + ggtitle("Wet weight for Carcinus")

holddf <- subset(all, all$Species.x == "HS")
ggplot(holddf, aes(x = WW)) + geom_histogram(binwidth = 1, fill = "darkred", color = "black") + facet_wrap(~Species.x, scales = "free") + ggtitle("Wet weight for Hemigrapsus")
```

For each species on wet weight normality:

-Cancer: Pretty normal

-Green crab: Normal with some outliers

-Hemi: Normal with some outliers

#### Plotting the proportion eaten to see outliers and normality

```{R, echo = FALSE}

ggplot(all, aes(x = proportion.eaten, fill = Species.x)) + geom_histogram(binwidth = 0.01) + facet_wrap(~Species.x, scales = "free") + ggtitle("Proportion eaten by species")+
  scale_fill_manual(values = c("CI" = "darkorange",
                                "CM"="darkgreen",
                                "HS"="darkred"))
#everyone looks normal except for hemigrapsus which has some trialing end points
```

It seems like Cancer crabs have a left leaning normality curve. Green crabs have a normal spread. Hemigrapsus have a left leaning curve as well. Unsure if this is even a valid graph because it's kind of what we expected if Cancer crabs are all tanking 0's due to it being too hot.

Actually, we need to look at general consumption over time.

Before we can analyze the proportion eaten, we have to understand if the acclimation worked... To do this, we'll bin each week by each other and calculate averages to compare.

```{R echo = FALSE, warning = FALSE}
holddf <- subset(all, all$Species.x == "CI")
ggplot(holddf, aes(x = as.numeric(WeekNum), y = proportion.eaten, color = as.factor(Period))) + geom_point() + facet_wrap(~Trial.x) +
  ggtitle("Proportion consumed over time for Period 1+2, Cancer Irroratus") + geom_smooth(method = "loess", se = FALSE)+
  scale_color_manual(values = c("1" = "darkorange",
                                "2"="darkgreen"))

holddf <- subset(all, all$Species.x == "CM")
ggplot(holddf, aes(x = as.numeric(WeekNum), y = proportion.eaten, color = as.factor(Period))) + geom_point() + facet_wrap(~Trial.x) +
  ggtitle("Proportion consumed over time for Period 1+2, Carcinus maenus") + geom_smooth(method = "loess", se = FALSE)+
  scale_color_manual(values = c("1" = "darkorange",
                                "2"="darkgreen"))

holddf <- subset(all, all$Species.x == "HS")
ggplot(holddf, aes(x = as.numeric(WeekNum), y = proportion.eaten, color = as.factor(Period))) + geom_point() + facet_wrap(~Trial.x) +
  ggtitle("Proportion consumed over time for Period 1+2, Hemigrapsus") + geom_smooth(method = "loess", se = FALSE)+
  scale_color_manual(values = c("1" = "darkorange",
                                "2"="darkgreen"))

#new column that is the temperature difference from it's target temperature
all$tempDiff <- abs(as.numeric(all$Trial.x) - all$Temperature)

ggplot(all, aes(x = Date.x, y = tempDiff, color = as.factor(Period))) + geom_point() + facet_wrap(~Trial.x, scales = "free_x")
```

### Looking at the proportion eaten for each trial for each individual species (CI, CM, and HS)

```{R echo = FALSE, warning = FALSE}
holddf <- subset(all, all$Species.x == "CI")
ggplot(holddf,aes(x = as.numeric(Trial.x), y = proportion.eaten, color = as.factor(Period))) + geom_point() + geom_smooth(method = "loess")+ 
  ggtitle("Proportion consumed over trial temperature for Period 1+2, Cancer irroratus") +
  scale_color_manual(values = c("1" = "orange1",
                                "2" = "orange4"))

holddf <- subset(all, all$Species.x == "CM")
ggplot(holddf,aes(x = as.numeric(Trial.x), y = proportion.eaten, color = as.factor(Period))) + geom_point() + geom_smooth(method = "loess") +
  ggtitle("Proportion consumed over trial temperature for Period 1+2, Carcinus meanus") +
  scale_color_manual(values = c("1" = "lightgreen",
                                "2" = "darkgreen"))

holddf <- subset(all, all$Species.x == "HS")
ggplot(holddf,aes(x = as.numeric(Trial.x), y = proportion.eaten, color = as.factor(Period))) + geom_point() + geom_smooth(method = "loess") +
  ggtitle("Proportion consumed over trial temperature for Period 1+2, Hemigrapsus") +
  scale_color_manual(values = c("1" = "pink",
                                "2" = "darkred"))
```
